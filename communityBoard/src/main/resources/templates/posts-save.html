<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CommunityBoard</title>
    <script src="https://kit.fontawesome.com/bdfd7f14f2.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/posts.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/post-detail.css}">
    <script th:inline="javascript" type="text/javascript" th:src="@{/js/main.js}" defer></script>
</head>
<body>
<!-- NavBar -->
<nav >
    <div class="navbar-container">
        <div>
            <h2 class="navbar__title"><a th:href="@{/}" >Community Board Project </a></h2>
        </div>
        <div>
            <ul class="navbar__menu">
                <li class="navbar__menu__item"><a th:href="@{/}" >Home</a></li>
                <li class="navbar__menu__item" th:unless="${userName}"><a th:href="@{/login}">로그인</a></li>
                <li class="navbar__menu__item" th:if="${userName}"><a th:href="@{/posts/save}">글쓰기</a></li>
                <li class="navbar__menu__item" th:if="${userName}"><a th:href="@{/logout}">로그아웃</a></li>
                <li class="navbar__menu__item" th:if="${userName}"><a th:href="@{/mypage}">마이 페이지</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="page-wrapper chiller-theme toggled">
    <nav id="sidebar" class="sidebar-wrapper">
        <div class="sidebar-content">
            <div class="sidebar-menu">
                <ul>
                    <li class="header-menu">
                        <span>게시판 분류</span>
                    </li>
                    <li th:each="category : ${categoryList}" class = "sidebar-dropdown">
                        <a href = "/api/v1/posts/category/${category.id}">
                            <span th:text="${category.name}"></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <!-- 작성 폼 -->
    <div id="container">
        <select class="select__box" th:name="category" id = "category-box">
            <option value = "카테고리"> 선택</option>
            <option th:each="val : ${categoryList}" th:value="${val?.id}" th:utext="${val?.name}"></option>
        </select>
        <div class = "wrap articles">
            <form class="write">
                <p ><input autocomplete="off" id = "title" placeholder="글 제목" class="title"></p>
                <p>
                    <textarea name="text" id = "content" placeholder="내용을 입력하세요." class="smallplaceholder"></textarea>
                </p>
                <ul class="option">
                    <li class = "attach"></li>
                    <li class = "submit" th:onclick="|javascript:save()|"></li>
                </ul>
            </form>
            <div class = "pagination">
                <a class = "cancel" href = "/">취소하기</a>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" th:src="@{/main.js}" defer></script>
<script type="text/javascript" src="../static/js/main.js" defer></script>

<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    function save(){
        var categoryBox = document.getElementById('category-box')
        let data = {
            category_id : categoryBox.options[categoryBox.selectedIndex].value,
            title : document.getElementById('title').value,
            content : document.getElementById('content').value
        };
        fetch("/api/v1/posts", {
            method: "POST",
            headers:{
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data)
        })
            .then((response) => {
                alert('글이 등록되었습니다.');
                window.location.href = '/';
            })
            .catch((e=>{
                alert(e);
            }))
    }

    /*]]>*/
</script>
</body>
</html>